# pppayments
Two PHP scripts...


### UDirectory Structure

```
/var/www/example.com/                 # Project root directory
├── .env                              # Environment configuration file (securely stored here)
├── vendor/                           # Composer dependencies folder (generated by Composer)
│   └── ...
├── pppayments/                       # Project folder containing PHP scripts
│   ├── pppaymentswh.php              # Main webhook script
│   ├── pppaymentstg.php              # Telegram notification script
│   ├── composer.json                 # Composer configuration file
│   ├── .env.example                  # Template for the .env file
│   └── ...
```

### Configuring the PHP Scripts

The PHP scripts (`pppaymentswh.php` and `pppaymentstg.php`) are already set up to look for the `.env` file in the **parent directory** using this configuration:

```php
require __DIR__ . '/../vendor/autoload.php';
use Dotenv\Dotenv;

// Load .env file from the parent directory (/var/www/example.com)
$dotenv = Dotenv::createImmutable(__DIR__ . '/../');
$dotenv->load();
```

- `__DIR__ . '/../'` specifies that the `.env` file is located one level up from the `pppayments` folder, which should be `/var/www/example.com/`.

### Setup Steps for `/var/www/example.com`

1. **Create the Project Root**:

   If it doesn't already exist, create the root directory:

   ```bash
   sudo mkdir -p /var/www/example.com
   ```

2. **Navigate to the Project Root**:

   ```bash
   cd /var/www/example.com
   ```

3. **Clone the GitHub Repository**:

   Clone your repository into the `pppayments` folder:

   ```bash
   git clone https://github.com/drhdev/pppayments.git pppayments
   ```

4. **Navigate to the `pppayments` Directory**:

   ```bash
   cd pppayments
   ```

5. **Run Composer to Install Dependencies**:

   ```bash
   composer install
   ```

6. **Create the `.env` File in the Project Root**:

   ```bash
   cp .env.example ../.env
   ```

7. **Edit the `.env` File**:

   Configure the `.env` file located in `/var/www/example.com`:

   ```bash
   nano ../.env
   ```

   Set the values for `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASS`, `TELEGRAM_BOT_TOKEN`, and `TELEGRAM_CHAT_ID` based on your environment.

8. **Set Permissions** to Secure the `.env` File:

   ```bash
   sudo chmod 600 ../.env
   sudo chown www-data:www-data ../.env
   ```

### Configuring Apache for `example.com`

If `example.com` is a virtual host on your Apache server, update your Apache configuration to point to `/var/www/example.com` as the root directory:

1. **Create a New Virtual Host Configuration File**:

   ```bash
   sudo nano /etc/apache2/sites-available/example.com.conf
   ```

2. **Add the Following Configuration**:

   ```apache
   <VirtualHost *:80>
       ServerAdmin webmaster@example.com
       DocumentRoot /var/www/example.com/pppayments
       ServerName example.com

       <Directory /var/www/example.com/pppayments>
           AllowOverride All
           Require all granted
       </Directory>

       ErrorLog ${APACHE_LOG_DIR}/example.com_error.log
       CustomLog ${APACHE_LOG_DIR}/example.com_access.log combined
   </VirtualHost>
   ```

3. **Enable the Site and Restart Apache**:

   ```bash
   sudo a2ensite example.com.conf
   sudo systemctl restart apache2
   ```

This setup ensures that:

- The `.env` file remains in a secure location (`/var/www/example.com`) and is not directly accessible via the web server.
- The PHP scripts in `pppayments/` can correctly access the environment variables.

